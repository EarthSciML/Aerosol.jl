<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Implementation details · Aerosol.jl</title><meta name="title" content="Implementation details · Aerosol.jl"/><meta property="og:title" content="Implementation details · Aerosol.jl"/><meta property="twitter:title" content="Implementation details · Aerosol.jl"/><meta name="description" content="Documentation for Aerosol.jl."/><meta property="og:description" content="Documentation for Aerosol.jl."/><meta property="twitter:description" content="Documentation for Aerosol.jl."/><meta property="og:url" content="https://aerosol.earthsci.dev/isorropia/implementation/"/><meta property="twitter:url" content="https://aerosol.earthsci.dev/isorropia/implementation/"/><link rel="canonical" href="https://aerosol.earthsci.dev/isorropia/implementation/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Aerosol.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Thermodynamics</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox" checked/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Isorropia</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../overview/">Overview</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li class="is-active"><a class="tocitem" href>Implementation details</a><ul class="internal"><li><a class="tocitem" href="#Problem-formulation"><span>Problem formulation</span></a></li><li><a class="tocitem" href="#Deliquescence"><span>Deliquescence</span></a></li><li><a class="tocitem" href="#Compositional-invariance-with-RH-cycling"><span>Compositional invariance with RH cycling</span></a></li></ul></li></ul></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Thermodynamics</a></li><li><a class="is-disabled">Isorropia</a></li><li class="is-active"><a href>Implementation details</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Implementation details</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/EarthSciML/Aerosol.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/EarthSciML/Aerosol.jl/blob/main/docs/src/isorropia/implementation.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><p>This implementation of ISORROPIA II is based on the description by Fountoukis and Nenes (2007), and may differ from the FORTRAN model which the paper describes. Below, we describe the notable  differences in model specification and solution that we are aware of.</p><h2 id="Problem-formulation"><a class="docs-heading-anchor" href="#Problem-formulation">Problem formulation</a><a id="Problem-formulation-1"></a><a class="docs-heading-anchor-permalink" href="#Problem-formulation" title="Permalink"></a></h2><p>The ISORROPIA II FORTRAN model is formulated as a nonlinear system of equations, which is solved numerically. For example, the following equation represents the equilibrium between <span>$\mathrm{Ca(NO3)2_{(s)}}$</span> and  <span>$( \mathrm{Ca^{2+}_{(aq)}} + \mathrm{2NO3^-_{(aq)}} )$</span>:</p><p class="math-container">\[K_{eq} = \frac{\left[ \mathrm{Ca^{2+}} \right] \left[ \mathrm{NO3^-} \right]^2 \gamma_{\mathrm{Ca^{2+}}} \gamma_{NO3^-} }{1}\]</p><p>where the numerator (<span>$\left[ \mathrm{Ca^{2+}} \right] \left[ \mathrm{NO3^-} \right]^2 \gamma_{\mathrm{Ca^{2+}}} \gamma_{NO3^-}$</span>)  represents the activity of the aqueous salt, the denominator (<span>$1$</span>) represents the activity of the solid,  and <span>$K_{eq}$</span> is the equilibrium ratio of the two.</p><p>In this implementation, we instead formulate the system of reactions as a mass action problem with forward  and reverse kinetic reactions that arrive at an equilibrium over time.  Using this method, the above reaction is represented as:</p><p class="math-container">\[\mathrm{CaNO32_{s}} \underset{\gamma_p / \gamma_r / K_eq}{\stackrel{1}{\rightleftharpoons}} \mathrm{Ca_{aq}} + 2 \mathrm{NO3_{aq}}\]</p><p>where <span>$( \gamma_p = \gamma_{\mathrm{Ca^{2+}}} \gamma_{NO3^-} )$</span> and <span>$( \gamma_r = 1 / \left[ \mathrm{Ca(NO3)2_{(s)}} \right] )$</span>.</p><p>The resulting chemical reaction network is converted into a system of ordinary differential equations and then solved. The advantage of this mass-action formulation is that it is numerically stable even without the extensive  numerical optimizations that are used in the FORTRAN version of ISORROPIA. However, we are turning a system that is represented as instantaneously reaching equilibrium into one that reaches equilibrium over time, so we need to make a choice about the timescale over which we want to reach equilibrium. We have found that in practice formulating the reaction rates as above results in equilibrium being reached in less than  10 seconds under typical conditions, which is fast enough compared to many gas-phase reactions that we can consider it  to be effectively instantaneous. However, to make the equilibrium occur more quickly or slowly we could simply multiply both forward and reverse reaction  rate constants by a constant factor.</p><h2 id="Deliquescence"><a class="docs-heading-anchor" href="#Deliquescence">Deliquescence</a><a id="Deliquescence-1"></a><a class="docs-heading-anchor-permalink" href="#Deliquescence" title="Permalink"></a></h2><p>When interpolation between MRDH and DRH relative humidities as in Foungtoukis and Nenes (2007), we take <span>$\mathrm{RH_{wet}}$</span> to be equal to the DRH of the species in question, rather than the DRH of the salt with the lowest DRH of the mixture  under consideration. (We do this for ease of implementation but would consider changing it if requested.)</p><h2 id="Compositional-invariance-with-RH-cycling"><a class="docs-heading-anchor" href="#Compositional-invariance-with-RH-cycling">Compositional invariance with RH cycling</a><a id="Compositional-invariance-with-RH-cycling-1"></a><a class="docs-heading-anchor-permalink" href="#Compositional-invariance-with-RH-cycling" title="Permalink"></a></h2><p>This is described in Section 3.2 of Fountoukis and Nenes (2007), but we do not do it  because it is not immediately clear how to do so in the mass-action framework we use here.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/">« Examples</a><a class="docs-footer-nextpage" href="../../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.0 on <span class="colophon-date" title="Thursday 12 October 2023 00:44">Thursday 12 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
